package com.GASB.anti_malware.service.dlp;

import com.GASB.anti_malware.model.dto.request.DlpPolicyRequestDto;
import com.GASB.anti_malware.model.dto.response.Result;
import com.GASB.anti_malware.model.entity.OrgSaaS;
import com.GASB.anti_malware.model.entity.Policy;
import com.GASB.anti_malware.repository.dlp.PiiRepo;
import com.GASB.anti_malware.repository.dlp.PolicyRepo;
import com.GASB.anti_malware.repository.org.OrgSaaSRepo;
import lombok.extern.slf4j.Slf4j;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

import java.util.List;

@Service
@Slf4j
public class DlpPolicyService {

    private final PolicyRepo policyRepo;
    private final PiiRepo piiRepo;
    private final OrgSaaSRepo orgSaaSRepo;

    @Autowired
    public DlpPolicyService(PolicyRepo policyRepo, PiiRepo piiRepo, OrgSaaSRepo orgSaaSRepo) {
        this.policyRepo = policyRepo;
        this.piiRepo = piiRepo;
        this.orgSaaSRepo = orgSaaSRepo;
    }

    public Result setPolicy(DlpPolicyRequestDto dlpPolicyRequestDto) {
        System.out.println("--------- 1 ---------\nEnter setPolicy()");
        Integer orgSaasId = dlpPolicyRequestDto.getOrgSaasId();
        OrgSaaS orgSaas = orgSaaSRepo.findById(orgSaasId).get();
        String policyName = dlpPolicyRequestDto.getPolicyName();
        String description = dlpPolicyRequestDto.getDescription();
        boolean identify = dlpPolicyRequestDto.isIdentify();
        boolean passport = dlpPolicyRequestDto.isPassport();
        boolean drive = dlpPolicyRequestDto.isDrive();
        boolean foreigner = dlpPolicyRequestDto.isForeigner();
        String comment = dlpPolicyRequestDto.getComment();


        System.out.println("--------- 2 ---------\n");
        System.out.println("Enter setPolicy()");
        System.out.println("orgSaasId: " + orgSaasId);
        System.out.println("policyName: " + policyName);
        System.out.println("description: " + description);
        System.out.println("identify: " + identify);
        System.out.println("passport: " + passport);
        System.out.println("drive: " + drive);
        System.out.println("foreigner: " + foreigner);
        System.out.println("comment: " + comment);

        System.out.println("--------- 3 ---------\n");
        System.out.println("How about orgSaas?");
        System.out.println("OrgSaas" + orgSaas);

        Policy policy = new Policy();
        policy.setPolicyName(policyName);
        policy.setOrgSaas(orgSaas);
        policy.setDescription(description);
        policy.setIdentify(identify);
        policy.setPassport(passport);
        policy.setDrive(drive);
        policy.setForeigner(foreigner);
        policy.setComment(comment);

        policyRepo.save(policy);

        return new Result(true, "Policy updated");
    }
}
