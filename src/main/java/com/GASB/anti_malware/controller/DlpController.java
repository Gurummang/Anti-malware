package com.GASB.anti_malware.controller;

import com.GASB.anti_malware.model.dto.request.DlpPolicyRequest;
import com.GASB.anti_malware.model.dto.request.DlpRequestDto;
import com.GASB.anti_malware.model.dto.response.DlpPolicyResp;
import com.GASB.anti_malware.model.dto.response.Result;
import com.GASB.anti_malware.model.entity.Policy;
import com.GASB.anti_malware.service.dlp.DlpPolicyService;
import com.GASB.anti_malware.service.dlp.DlpService;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.web.bind.annotation.*;

import java.util.List;

@RestController
@RequestMapping("/api/v1/vt")
public class DlpController {

    private final DlpService dlpService;
    private final DlpPolicyService dlpPolicyService;

    @Autowired
    public DlpController(DlpService dlpService, DlpPolicyService dlpPolicyService) {
        this.dlpService = dlpService;
        this.dlpPolicyService = dlpPolicyService;
    }

    @PostMapping("/mq")
    public void dlpMQ(@RequestBody DlpRequestDto dlpRequestDto) throws Exception {
        Long fileId = dlpRequestDto.getFileId();
        dlpService.dlpFunc(fileId);
    }

    // Policy CRUD
    @PostMapping("/policy/make")
    public List<DlpPolicyResp> setPolicy(@RequestBody DlpPolicyRequest dlpPolicyRequest) {
        return dlpPolicyService.setPolicy(dlpPolicyRequest);
    }

    @PostMapping("/policy/delete")
    public List<DlpPolicyResp> deletePolicy(@RequestBody DlpPolicyRequest dlpPolicyRequest) {
        return dlpPolicyService.deletePolicy(dlpPolicyRequest);
    }

    @GetMapping("/policy/list")
    public List<DlpPolicyResp> getPolicyList(@RequestBody DlpPolicyRequest dlpPolicyRequest) {
        return dlpPolicyService.getPolicyList(dlpPolicyRequest);
    }
}