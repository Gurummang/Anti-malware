package com.GASB.anti_malware.controller;

import com.GASB.anti_malware.model.dto.request.DlpPolicyRequestDto;
import com.GASB.anti_malware.model.dto.request.DlpRequestDto;
import com.GASB.anti_malware.model.dto.response.Result;
import com.GASB.anti_malware.model.entity.Policy;
import com.GASB.anti_malware.service.dlp.DlpPolicyService;
import com.GASB.anti_malware.service.dlp.DlpService;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.web.bind.annotation.*;

@RestController
@RequestMapping("/api/v1/dlp")
public class DlpController {

    private final DlpService dlpService;
    private final DlpPolicyService dlpPolicyService;

    @Autowired
    public DlpController(DlpService dlpService, DlpPolicyService dlpPolicyService) {
        this.dlpService = dlpService;
        this.dlpPolicyService = dlpPolicyService;
    }

    @PostMapping("/mq")
    public void dlpMQ(@RequestBody DlpRequestDto dlpRequestDto) throws Exception {
        Long fileId = dlpRequestDto.getFileId();
        dlpService.dlpFunc(fileId);
    }

    @PostMapping("/policy")
    public Result setPolicy(@RequestBody DlpPolicyRequestDto dlpPolicyRequestDto) {
        return dlpPolicyService.setPolicy(dlpPolicyRequestDto);
    }
}
